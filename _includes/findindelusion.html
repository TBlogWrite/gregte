<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>K√©o th·∫£ m√†u c∆° b·∫£n & pha tr·ªôn</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background: #f0f0f0;
            font-family: sans-serif;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 120px);
            gap: 15px;
            justify-content: center;
            margin: 20px;
            position: relative;
            z-index: 1;
        }

        .slot,
        .piece {
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            border: none;
            user-select: none;
            position: absolute;
        }

        .slot {
            background: #fff;
            color: #333;
            border: 3px dashed #666;
            cursor: default;
            position: relative;
        }

        .piece {
            color: white;
            cursor: grab;
            box-shadow:
                inset -3px -3px 6px rgba(255, 255, 255, 0.6),
                inset 3px 3px 6px rgba(0, 0, 0, 0.3),
                0 6px 12px rgba(0, 0, 0, 0.4);
            z-index: 100;
        }

        .piece.dragging {
            cursor: grabbing;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
            z-index: 1000;
        }



        canvas {
            display: block;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            /* canvas n·∫±m d∆∞·ªõi */
        }

        .container {
            position: relative;
            z-index: 1;
            /* container n·∫±m tr√™n canvas */
            text-align: center;
            color: #222;
        }

        .notify {
            position: fixed;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease;
            max-width: 250px;
            word-wrap: break-word;
            z-index: 9999;
        }

        .notify.show {
            opacity: 1;
            transform: scale(1);
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>K√©o v√†o √¥ ƒë√∫ng m√†u !!!</h2>
        <div class="grid" id="grid"></div>
    </div>


    <canvas id="canvas"></canvas>
    <div class="notify" id="notify"></div>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        const colors = [
            { name: "Ch√¨a Kh√≥a", color: "#ff0000" },
            { name: "V√≠ ti·ªÅn", color: "#0066ff" },
            { name: "C·∫°o r√¢u", color: "#ffd500" },
            { name: "ƒêi·ªán tho·∫°i", color: "#8000ff" },
            { name: "Game", color: "#ff6600" },
            { name: "T·∫•t/V·ªõ", color: "#00b300" }
        ];

        const pieces = [];
        let dragging = null;
        let offsetX = 0, offsetY = 0;

        // t·∫°o c√°c n√∫t m√†u
        function getClientPos(e) {
            if (e.touches && e.touches.length > 0) {
                return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            } else if (e.changedTouches && e.changedTouches.length > 0) {
                return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
            } else {
                return { x: e.clientX, y: e.clientY };
            }
        }

        const slots = [
            { id: "Ch√¨a Kh√≥a", label: "ƒê·ªè" },
            { id: "V√≠ ti·ªÅn", label: "Xanh d∆∞∆°ng" },
            { id: "C·∫°o r√¢u", label: "V√†ng" },
            { id: "ƒêi·ªán tho·∫°i", label: "T√≠m" },
            { id: "Game", label: "Cam" },
            { id: "T·∫•t/V·ªõ", label: "Xanh l√°" }
        ];

        // H√†m shuffle m·∫£ng (Fisher‚ÄìYates)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // render ng·∫´u nhi√™n
        const grid = document.getElementById("grid");
            shuffle(slots).forEach(s => {
            const div = document.createElement("div");
            div.className = "slot";
            div.dataset.id = s.id;
            div.textContent = s.label;
            grid.appendChild(div);
        });

        colors.forEach(c => {
            const el = document.createElement('div');
            el.className = 'piece';
            el.textContent = c.name;
            el.style.background = c.color;
            el.dataset.id = c.name;
            document.body.appendChild(el);

            const piece = {
                el,
                x: Math.random() * (canvas.width - 120),
                y: Math.random() * (canvas.height - 120),
                vx: (Math.random() - 0.5) * 4,
                vy: (Math.random() - 0.5) * 4,
                moving: true
            };
            pieces.push(piece);

            // b·∫Øt ƒë·∫ßu k√©o (chu·ªôt + c·∫£m ·ª©ng)
            const startDrag = e => {
                const pos = getClientPos(e);
                dragging = piece;
                piece.moving = false;
                offsetX = pos.x - piece.x;
                offsetY = pos.y - piece.y;
                el.classList.add("dragging");
            };

            el.addEventListener("mousedown", startDrag);
            el.addEventListener("touchstart", startDrag, { passive: true });
        });

        // di chuy·ªÉn (chu·ªôt + c·∫£m ·ª©ng)
        const moveDrag = e => {
            if (dragging) {
                const pos = getClientPos(e);
                dragging.x = pos.x - offsetX;
                dragging.y = pos.y - offsetY;
                dragging.el.style.left = dragging.x + "px";
                dragging.el.style.top = dragging.y + "px";
            }
        };

        document.addEventListener("mousemove", moveDrag);
        document.addEventListener("touchmove", moveDrag, { passive: true });

        let oldPlace;
        let correctCount = 0;  // ƒë·∫øm s·ªë m√†u ƒë√£ th·∫£ ƒë√∫ng

        const endDrag = e => {
            if (dragging) {
                const pos = getClientPos(e);
                let dropped = false;

                document.querySelectorAll(".slot").forEach(s => {
                    const rect = s.getBoundingClientRect();
                    if (
                        pos.x > rect.left &&
                        pos.x < rect.right &&
                        pos.y > rect.top &&
                        pos.y < rect.bottom
                    ) {
                        if (s.dataset.id === dragging.el.dataset.id) {
                            s.textContent = "";
                            s.style.background = dragging.el.style.background;
                            s.style.color = "white";
                            s.style.border = "none";
                            s.style.boxShadow = "0 6px #666";
                            dragging.el.remove();
                            dropped = true;

                            correctCount++; // tƒÉng s·ªë m√†u ƒë√∫ng

                            // ki·ªÉm tra ho√†n th√†nh game
                            if (correctCount === colors.length) {
                                showWinPopup();
                            }
                        } else {
                            let randomPlace;
                            do {
                                randomPlace = places[Math.floor(Math.random() * places.length)];
                            } while (oldPlace === randomPlace);
                            alert(`Sai √¥ r·ªìi b·∫°n ∆°i! C√≥ khi n√†o n√≥ n·∫±m ·ªü: ${randomPlace} ü§î`);
                        }
                    }
                });

                if (!dropped) dragging.moving = true;

                dragging.el.classList.remove("dragging");
                dragging = null;
            }
        };

        // H√†m hi·ªán popup khi th·∫Øng
        function showWinPopup() {
            const popup = document.createElement("div");
            popup.innerHTML = `
                <div style="
                    position:fixed;
                    top:50%; left:50%;
                    transform:translate(-50%, -50%);
                    background:white;
                    padding:30px;
                    border-radius:15px;
                    box-shadow:0 0 20px rgba(0,0,0,0.4);
                    text-align:center;
                    font-size:20px;
                    z-index:9999;
                ">
                    üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh ! Ra kh·ªèi ph√≤ng v√† ƒëi xe c·∫©n th·∫≠n ! üéâ<br><br>
                    <button id="restartBtn" style="
                        margin-top:15px;
                        padding:10px 20px;
                        font-size:16px;
                        border:none;
                        border-radius:8px;
                        background:#4CAF50;
                        color:white;
                        cursor:pointer;
                    ">Ch∆°i l·∫°i</button>
                </div>
            `;
            document.body.appendChild(popup);

            document.getElementById("restartBtn").onclick = () => {
                location.reload();
            };
        }

        document.addEventListener("mouseup", endDrag);
        document.addEventListener("touchend", endDrag);

        const places = [
            "Tr√™n b√†n l√†m vi·ªác",
            "Trong t√∫i qu·∫ßn/t√∫i √°o",
            "Trong balo/t√∫i x√°ch",
            "Tr√™n k·ªá gi√†y",
            "Trong h·ªôc t·ªß ƒë·∫ßu gi∆∞·ªùng",
            "Treo tr√™n m√≥c c·ª≠a",
            "Trong c·ªëp xe",
            "D∆∞·ªõi g·ªëi ho·∫∑c tr√™n gi∆∞·ªùng",
            "Tr√™n sofa/ph√≤ng kh√°ch",
            "Tr√™n n√≥c t·ªß l·∫°nh (ho·∫∑c k·ªá t·ªß l·∫°nh üòÖ)",
            "Trong ngƒÉn k√©o b·∫øp",
            "ƒê·ªÉ l·∫´n trong ƒë·ªëng qu·∫ßn √°o gi·∫∑t",
            "B·ªè trong t√∫i √°o kho√°c treo l√¢u ng√†y",
            "·ªû nh√† v·ªá sinh (b·ªá r·ª≠a m·∫∑t, k·ªá x√† ph√≤ng)",
            "B·ªè qu√™n ·ªü qu√°n c√† ph√™/nh√† h√†ng",
            "B·ªè v√†o h·ªôp gi·∫•y d∆∞·ªõi g·∫ßm gi∆∞·ªùng",
            "Trong s√°ch (x√†i nh∆∞ bookmark)",
            "Tr√™n m√°y t√≠nh/laptop",
            "B·ªè trong h·ªôp b√°nh k·∫πo/ly c·ªëc cho ti·ªán tay",
            "Tr√™n ƒë·∫ßu t·ªß gi√†y ho·∫∑c trong h·ªôp gi√†y",
            "Trong vali l√¢u ng√†y kh√¥ng m·ªü"
        ];

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // M·∫£ng ch·ª©a c√°c h·∫°t kh√≥i
        let particles = [];

        class Smoke {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = 50 + Math.random() * 80; // k√≠ch th∆∞·ªõc ƒë√°m kh√≥i
                this.opacity = 0.1 + Math.random() * 0.3;
                this.speedX = (Math.random() - 0.5) * 1;
                this.speedY = (Math.random() - 0.5) * 1;
                this.life = 300 + Math.random() * 200;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life--;
                if (this.life < 50) this.opacity -= 0.005; // m·ªù d·∫ßn
            }

            draw() {
                const gradient = ctx.createRadialGradient(this.x, this.y, this.size * 0.1, this.x, this.y, this.size);
                gradient.addColorStop(0, `rgba(200,200,200,${this.opacity})`); // trung t√¢m x√°m nh·∫°t
                gradient.addColorStop(1, `rgba(180,180,180,0)`);               // r√¨a loang m·ªù
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function addSmoke() {
            if (particles.length < 80) { // gi·ªõi h·∫°n s·ªë ƒë√°m kh√≥i
                particles.push(new Smoke());
            }
        }

        function animate() {

            pieces.forEach(p => {
                if (p.moving) {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.x <= 0 || p.x >= window.innerWidth - 120) p.vx *= -1;
                    if (p.y <= 0 || p.y >= window.innerHeight - 120) p.vy *= -1;
                    p.el.style.left = p.x + "px";
                    p.el.style.top = p.y + "px";
                }
            });

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach((p, i) => {
                p.update();
                p.draw();
                if (p.life <= 0 || p.opacity <= 0) {
                    particles.splice(i, 1);
                }
            });

            addSmoke();
            requestAnimationFrame(animate);
        }

        animate();

        // Resize m√†n h√¨nh
        window.addEventListener("resize", () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        const messages = [
            "H√¨nh nh∆∞ crush m·ªõi l·∫•y ch√¨a kh√≥a nh√† m√¨nh‚Ä¶",
            "Kh√¥ng l·∫Ω c√¥ ·∫•y v√†o ph√≤ng m√¨nh l·∫•y c·∫Øp tr√°i tim r·ªìi‚Ä¶",
            "Ai gh√©t m√¨nh ch·∫Øc ƒë√£ v·ª©t ƒë·ªì m√¨nh ƒë√¢u ƒë√≥‚Ä¶",
            "C√≥ khi n√†o crush l√©n ƒë·∫∑t camera trong ph√≤ng m√¨nh kh√¥ng‚Ä¶",
            "T·ª± nhi√™n m·∫•t ng·ªß, ch·∫Øc c√≥ ng∆∞·ªùi ƒëang nghƒ© v·ªÅ m√¨nh‚Ä¶",
            "ƒêi·ªán tho·∫°i rung nh·∫π, ch·∫Øc crush v·ª´a nh·∫Øc t·ªõi t√™n m√¨nh‚Ä¶",
            "Kh√¥ng l·∫Ω c√¥ ·∫•y l√©n ƒë·ªïi pass laptop c·ªßa m√¨nh r·ªìi‚Ä¶",
            "H√¨nh nh∆∞ ai v·ª´a ƒÉn v·ª•ng h·∫øt ƒë·ªì ƒÉn m√¨nh ƒë·ªÉ trong t·ªß l·∫°nh‚Ä¶",
            "C√≥ khi n√†o crush m∆∞·ª£n d√©p m√¨nh ƒëi d·∫°o m√† kh√¥ng n√≥i‚Ä¶",
            "T·ª± d∆∞ng m∆∞a to, ch·∫Øc tr·ªùi ƒëang kh√≥c th∆∞∆°ng cho m√¨nh‚Ä¶",
            "Kh√¥ng l·∫Ω crush gi·∫£ v·ªù b∆° m√¨nh ƒë·ªÉ th·ª≠ l√≤ng‚Ä¶",
            "H√¨nh nh∆∞ c√≥ ai ƒë√≥ thay avatar gi·ªëng m√¨nh ƒë·ªÉ theo d√µi crush‚Ä¶",
            "C·ªëc n∆∞·ªõc m√¨nh v·ª´a u·ªëng, ch·∫Øc c√≥ ng∆∞·ªùi b·ªè th√™m ‚Äúth√≠nh‚Äù v√†o‚Ä¶",
            "C√≥ khi n√†o crush l√©n ghi √¢m gi·ªçng m√¨nh ƒë·ªÉ nghe l·∫°i m·ªói t·ªëi‚Ä¶",
            "Kh√¥ng l·∫Ω c√¥ ·∫•y hack pass Facebook m√¨nh r·ªìi‚Ä¶",
            "H√¨nh nh∆∞ c√≥ ng∆∞·ªùi l√©n d·ªçn ph√≤ng m√¨nh, m√† m√¨nh v·∫´n th·∫•y b·ª´a‚Ä¶",
            "T·ª± nhi√™n l·∫°nh g√°y, ch·∫Øc crush v·ª´a l√©n nh√¨n t·ª´ xa‚Ä¶",
            "C√≥ khi n√†o c√¥ ·∫•y th·∫•y tin nh·∫Øn m√¨nh nh∆∞ng c·ªë t√¨nh kh√¥ng rep‚Ä¶",
            "Kh√¥ng l·∫Ω crush ƒë√£ tr·ªôm m·∫•t gi·∫•c ng·ªß tr∆∞a c·ªßa m√¨nh r·ªìi‚Ä¶",
            "H√¨nh nh∆∞ c√≥ ai ƒë√≥ c·ªë t√¨nh ƒë√°nh r∆°i k·ª∑ ni·ªám c·ªßa m√¨nh‚Ä¶",
            "T·ª± d∆∞ng tim ƒë·∫≠p nhanh, ch·∫Øc crush v·ª´a nh·∫Øc t√™n m√¨nh ·ªü ƒë√¢u ƒë√≥‚Ä¶",
            "C√≥ khi n√†o c√¥ ·∫•y ƒëi qua nh√† m√¨nh m√† kh√¥ng g·ªçi c·ª≠a‚Ä¶",
            "Kh√¥ng l·∫Ω crush v√†o gi·∫•c m∆° m√¨nh ƒë·ªÉ ‚Äúsoi‚Äù cu·ªôc s·ªëng‚Ä¶",
            "H√¨nh nh∆∞ ai ƒë√≥ v·ª´a thay ƒë·ªïi s·ªë ph·∫≠n c·ªßa m√¨nh m√† ch∆∞a b√°o‚Ä¶",
            "C√≥ khi n√†o crush gi·∫£ v·ªù gh√©t m√¨nh nh∆∞ng th·∫≠t ra th√≠ch l·∫Øm‚Ä¶",
            "Kh√¥ng l·∫Ω c√¥ ·∫•y m∆∞·ª£n v√≠ m√¨nh ƒëi shopping r·ªìi‚Ä¶",
            "H√¨nh nh∆∞ c√≥ ai ƒë√≥ tr·ªôm m·∫•t c√°i b√≥ng c·ªßa m√¨nh‚Ä¶",
            "T·ª± nhi√™n th·∫•y gi√≥ th·ªïi, ch·∫Øc crush v·ª´a th·ªü d√†i v√¨ nh·ªõ m√¨nh‚Ä¶",
            "C√≥ khi n√†o c√¥ ·∫•y t·∫°o nick ·∫£o ƒë·ªÉ n√≥i chuy·ªán v·ªõi m√¨nh‚Ä¶",
            "Kh√¥ng l·∫Ω crush ƒëang ng·ªìi ngay sau l∆∞ng m√¨nh m√† m√¨nh kh√¥ng hay‚Ä¶"
        ];

        const notify_colors = [
            { bg: "#ff6b6b", color: "#fff" },
            { bg: "#1dd1a1", color: "#fff" },
            { bg: "#54a0ff", color: "#fff" },
            { bg: "#feca57", color: "#000" },
            { bg: "#5f27cd", color: "#fff" },
            { bg: "#222f3e", color: "#f1f1f1" }
        ];

        const notify = document.getElementById("notify");
        let oldmsg;
        function showMessage() {
            // n·∫øu ƒë√£ ho√†n th√†nh game th√¨ kh√¥ng hi·ªán n·ªØa
            if (correctCount === colors.length) return;
        
            let msg;
            do {
                msg = messages[Math.floor(Math.random() * messages.length)];
            } while (oldmsg === msg);
            oldmsg = msg;
        
            const style = notify_colors[Math.floor(Math.random() * notify_colors.length)];
            notify.textContent = msg;
        
            // random v·ªã tr√≠
            const x = Math.random() * (window.innerWidth - 300);
            const y = Math.random() * (window.innerHeight - 100);
        
            notify.style.left = `${x}px`;
            notify.style.top = `${y}px`;
        
            // random style
            notify.style.background = style.bg;
            notify.style.color = style.color;
            notify.style.borderRadius = `${10 + Math.random() * 30}px`;
            notify.style.boxShadow = `0 6px 15px rgba(0,0,0,${0.3 + Math.random() * 0.4})`;
        
            notify.classList.add("show");
        
            // ·∫©n sau 3 gi√¢y
            setTimeout(() => {
                notify.classList.remove("show");
            }, 3000);
        
            // l·∫∑p l·∫°i sau 5‚Äì10 gi√¢y (ch·ªâ khi ch∆∞a k·∫øt th√∫c game)
            if (correctCount !== colors.length) {
                const delay = 3500;
                setTimeout(showMessage, delay);
            }
        }
        
        // ch·ªâ b·∫Øt ƒë·∫ßu v√≤ng l·∫∑p message n·∫øu game ch∆∞a k·∫øt th√∫c
        if (correctCount !== colors.length) {
            setTimeout(showMessage, 2000);
        }
    </script>
</body>

</html>